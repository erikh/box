<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Verbs - Box</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	      <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <img class="box-logo" src="https://raw.githubusercontent.com/box-builder/box/master/docs-theme/img/box-logo.png">
            <a class="navbar-brand" href="../..">Box</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../.." class="dropdown-toggle"><span>Intro</span></a>
                    </li>
                    <li >
                        <a href="../../usage/" class="dropdown-toggle"><span>Usage</span></a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span>User Guide<b class="caret"></b></span></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../cli/">Command-Line Options</a>
</li>
                            
<li class="active">
    <a href="./">Verbs</a>
</li>
                            
<li >
    <a href="../functions/">Functions</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a class="git-link" href="https://github.com/box-builder/box">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>


            </ul>
        </div>
    </div>
</div>
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#label">label</a></li>
        <li class="main "><a href="#debug">debug</a></li>
        <li class="main "><a href="#after">after</a></li>
        <li class="main "><a href="#set95exec">set_exec</a></li>
        <li class="main "><a href="#workdir">workdir</a></li>
        <li class="main "><a href="#user">user</a></li>
        <li class="main "><a href="#flatten">flatten</a></li>
        <li class="main "><a href="#tag">tag</a></li>
        <li class="main "><a href="#entrypoint">entrypoint</a></li>
        <li class="main "><a href="#from">from</a></li>
        <li class="main "><a href="#run">run</a></li>
        <li class="main "><a href="#with95user">with_user</a></li>
        <li class="main "><a href="#inside">inside</a></li>
        <li class="main "><a href="#env">env</a></li>
        <li class="main "><a href="#cmd">cmd</a></li>
        <li class="main "><a href="#copy">copy</a></li>
    </ul>
</div></div>

        <div class="container">
            <div class="col-md-9" role="main">

<p>Verbs take action on a container and usually create a layer. Some commands can
be used to move data into and out of containers, or set properties and run
commands.</p>
<h2 id="label">label</h2>
<p><code>label</code> creates a label inside the image. It will append any labels that are
specified in each label command, for example, if you were to:</p>
<pre><code class="ruby">label foo: &quot;bar&quot;
label quux: &quot;baz&quot;
</code></pre>

<p>If you were to <code>docker inspect</code> this, your ending labels would be:</p>
<pre><code class="json">{
  &quot;foo&quot;: &quot;bar&quot;,
  &quot;quux&quot;: &quot;baz&quot;
}
</code></pre>

<p>You can also do this all as one label:</p>
<pre><code class="ruby">label foo: &quot;bar&quot;, quux: &quot;baz&quot;
</code></pre>

<p>Or if you'd like, store them in a variable for a final commit at the end:</p>
<pre><code class="ruby">mylabels = { }
mylabels[&quot;foo&quot;] = &quot;baz&quot;
# ... some stuff that generates mydata
mylabels[&quot;quux&quot;] = mydata

label mylabels # voila!
</code></pre>

<h2 id="debug">debug</h2>
<p><code>debug</code> drops to a container's shell (bash by default, but an argument can be
provided to change this) at the current place in the build cycle when invoked.
Changes to the container will be persisted through the rest of the run, and a
layer will be created.</p>
<p>If the shell exits non-zero, like <code>run</code> it will abort the build.</p>
<p>There is currently no way to detach from a debug session. Close the shell
and/or programs.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
copy &quot;.&quot;, &quot;/test&quot;
debug # verify all files landed in test like you expected them to
run &quot;chown -R erikh:erikh /test&quot; # this will run after you close the shell
</code></pre>

<h2 id="after">after</h2>
<p><code>after</code> coordinates with <code>skip</code> to provide layer editing facilities. After the
image is recomposed, this hook will run. Great for tagging and flattening.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

# after the skip layers are removed, run this hook.
after do
  # tag the edited image as `dev`
  tag &quot;dev&quot;
end

skip do
  run &quot;apt-get update -qq&quot;
end

run &quot;apt-get install tmux -y&quot;
</code></pre>

<h2 id="set95exec">set_exec</h2>
<p><code>set_exec</code> sets both the entrypoint and cmd at the same time.</p>
<p><code>set_exec</code> takes a dictionary consisting of two known elements as symbols:
entrypoint and cmd. They each take a string array which is then propagated
to the respective properties in the container's configuration.</p>
<p>This command does not modify the entrypoint or cmd for <code>run</code> operations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# this sets the what will be run with `/bin/echo foo`
set_exec entrypoint: [&quot;/bin/echo&quot;], cmd: [&quot;foo&quot;]
</code></pre>

<h2 id="workdir">workdir</h2>
<p>workdir sets the working directory in the docker environment. It sets this
throughout the image creation; all run/copy statements will respect this
value. If you wish to break out or work within it further, look at the
<code>inside</code> call.</p>
<p>The workdir, if left empty by either the parent in <code>from</code> or from no
interaction from the plan, is set to <code>/</code> to avoid inheriting accidentally from
the parent image.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# each container that runs this image without the `-w` flag will start as
# `/test` for the current working directory.
workdir '/test'
</code></pre>

<h2 id="user">user</h2>
<p>user sets the username this container will use by default. It also affects
following run statements (but not copy, which always copies as root
currently). If you wish to switch to a user temporarily, consider using
<code>with_user</code>.</p>
<p>An empty user is always set to <code>root</code> in the final image.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# all containers started with this image will use user `foo`
# %q[] just means, &quot;quote this as a string without interpolation&quot;
user %q[foo]
</code></pre>

<h2 id="flatten">flatten</h2>
<p>flatten requires no argumemnts and flattens all layers and commits a new
layer. This is useful for reducing the size of images or making them easier
to distribute.</p>
<p>NOTE: flattening will always bust the build cache.</p>
<p>NOTE: flattening requires downloading the image and re-uploading it. This
can take a lot of time over remote connections and is not advised.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# create some layers
run &quot;true&quot;
copy &quot;.&quot;, &quot;/test&quot;
flatten # image is shrunk to one layer here
tag &quot;erikh/test&quot;
</code></pre>

<h2 id="tag">tag</h2>
<p>tag tags an image within the docker daemon, named after the string provided.
It must be a valid tag name.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
run &quot;true&quot; # create a layer
tag &quot;erikh/true&quot; # tag the latest image as &quot;erikh/true&quot;
</code></pre>

<h2 id="entrypoint">entrypoint</h2>
<p>entrypoint sets the entrypoint for the image at runtime. It will not be
used for run invocations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# if you pass nil or an empty array, it will clear any inherited cmd from the debian image.
entrypoint []
entrypoint %w[/bin/echo -e] # arrays also work
entrypoint &quot;/bin/echo&quot;      # all `docker run` commands will be preceded by this
cmd &quot;foo&quot;                   # this will equate to `/bin/echo foo`
</code></pre>

<h2 id="from">from</h2>
<p>from sets the initial image and if necessary, pulls it from the registry. It
also sets the initial layer and must be called before several operations.</p>
<p>Using <code>from</code> overwrites all container configuration, including <code>workdir</code>,
<code>user</code>, <code>env</code>, <code>cmd</code>, and <code>entrypoint</code>.</p>
<p>It is expected that <code>from</code> is called first in a build plan.</p>
<p>If <code>from :scratch</code> is provided, the build plan will start out with no files and
no configuration. You will want to use <code>copy</code>, <code>set_exec</code>, etc to configure
your container image.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
</code></pre>

<p>or other images with full tags:</p>
<pre><code class="ruby">from &quot;ceph/rbd:latest&quot;
</code></pre>

<p>or fully qualified image IDs.</p>
<pre><code class="ruby"># sha256s are longer than this normally.
from &quot;sha256:deadbeefcafebabeaddedbeef&quot;
</code></pre>

<p><code>from :scratch</code>:</p>
<pre><code class="ruby">from :scratch
copy &quot;box&quot;, &quot;/&quot;
entrypoint &quot;/box&quot;
</code></pre>

<h2 id="run">run</h2>
<p>run runs a command provided as a string, and saves the layer.</p>
<p>It respects user and workdir, but not entrypoint and command. It does this
so it can respect the values provided in the plan instead of what was
intended for the final image.</p>
<p>Options:</p>
<ul>
<li><code>output</code>: supply <code>false</code> to omit output from the plan run.</li>
</ul>
<p>Cache keys are generated based on the command name, so to be certain your
command is run in the event of it hitting cache, run box with NO_CACHE=1.</p>
<p>Examples:</p>
<p>Create a file called <code>/bar</code> inside the container, then chown it to nobody. Run
commands don't need a lot of <code>&amp;&amp;</code> because you can trivially flatten the layers.</p>
<p>Run does not accept the exec-form from docker's RUN equivalent. Everything RUN
processes goes through <code>/bin/sh -c</code>.</p>
<pre><code class="ruby">from &quot;debian&quot;
run &quot;echo foo &gt;/bar&quot;
run &quot;chown nobody:nogroup /bar&quot;
</code></pre>

<p>Run in the context of a specific user or workdir. This allows us to finely
control our run invocations and further processing after the container image
has been run.</p>
<pre><code class="ruby">from &quot;debian&quot;

with_user &quot;nobody&quot; do # just the commands inside this block will run as `nobody`
  run &quot;echo foo &gt;/tmp/bar&quot;
end

# notice how we are still root
run &quot;useradd -s /bin/sh -m -d /home/erikh erikh&quot;

# all commands from here on will run as `erikh`, overridden only by `with_user`
# and other `user` calls.
user &quot;erikh&quot;
run &quot;echo foo &gt;/tmp/erikh-file&quot;

# set the workdir temporarily for the commands within the block.
# this will create /tmp/another-file-in-tmp.
inside &quot;/tmp&quot; do
  run &quot;echo foo &gt;another-file-in-tmp&quot;
end

# this behaves exactly like user, just setting the default cwd instead:
# creates /tmp/yet-another-file
workdir &quot;/tmp&quot;
run &quot;echo foo &gt;yet-another-file&quot;

# will not display anything
run &quot;ls -l /&quot;, output: false
</code></pre>

<h2 id="with95user">with_user</h2>
<p><code>with_user</code>, when provided with a string username and block invokes commands
within the user's login context. Unfortunately, copy does not respect this
yet. It does not affect the final image.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

with_user &quot;nobody&quot; do
  run &quot;whoami&quot; # i am nobody!
end
</code></pre>

<h2 id="inside">inside</h2>
<p>inside, when provided with a directory name string and block, invokes
commands within the context of the working directory being set to the
string.</p>
<p>It will affect the final image if a file-modification event occurs inside a
directory which has been specified but not created manually yet. This is a side
effect of the docker engine's relationship to how we use <code>workdir</code> directives
within docker itself. <strong>Docker will create any workdir that does not exist when
a build container is started.</strong></p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

inside &quot;/dev&quot; do
  run &quot;mknod webscale c 1 3&quot;
end
</code></pre>

<p>When given a relative path, it assumes the workdir as well as any other
additional inside statements. For example:</p>
<pre><code class="ruby">workdir &quot;/etc&quot;
inside &quot;apt&quot; do # will travel into /etc/apt/
  run &quot;rm sources.list&quot;
end
</code></pre>

<h2 id="env">env</h2>
<p>env, when provided with a hash of string =&gt; string key/value combinations,
will set the environment in the image and future run invocations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

env &quot;GOPATH&quot; =&gt; &quot;/go&quot;, &quot;PATH&quot; =&gt; &quot;/usr/bin:/bin&quot;
env GOPATH: &quot;/go&quot;, PATH: &quot;/usr/bin:/bin&quot; # equivalent if you prefer this syntax
</code></pre>

<h2 id="cmd">cmd</h2>
<p>cmd, when provided with a string will set the docker image's Cmd property,
which are the arguments that follow the entrypoint (and are overridden when
you provide a command to <code>docker run</code>). It does not affect run invocations.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# if you pass nil or an empty array, it will clear any inherited cmd from the debian image.
cmd nil
# You can also use arrays.
cmd %w[ls -la]
# This image will run `ls` in the workdir by default.
cmd &quot;ls&quot;
</code></pre>

<h2 id="copy">copy</h2>
<p>copy copies files from the host to the container. It only works relative to
the current directory. The build cache is calculated by summing the tar
result of edited files. Since mtime is also considered, changes to that will
also bust the cache.</p>
<p>copy accepts globbing on the local side (LHS of arguments) according to
<a href="https://golang.org/pkg/path/filepath/#Match">these rules</a>. For example, it
supports <code>*</code> but not the zsh extended <code>**</code> syntax.</p>
<p>Parameters may be specified after the target directory; the following options
are supported:</p>
<ul>
<li><code>ignore_list</code>: the provided array of file patterns will be ignored from the
  copied product.</li>
<li><code>ignore_file</code>: similar to <code>ignore_list</code>, it will reap the values from the
  filename specified.</li>
</ul>
<p>NOTE: copy will not overwrite directories with files, this will abort the run.
If you are trying to copy a file into a named directory, suffix it with <code>/</code>
which will instruct it to put it into that directory instead of trying to
replace it with the file you're copying.</p>
<p>NOTE: copy does not respect user permissions when the <code>user</code> or <code>with_user</code>
modifiers are applied. This will be fixed eventually.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;

# recursively copies everything the cwd to test, which is relative to the
# workdir inside the container (`/` by default).
workdir &quot;/tmp&quot;, do
  copy &quot;.&quot;, &quot;/test&quot;
end

copy &quot;a_file&quot;, &quot;/tmp/&quot; # example of not overwriting directories with files
copy &quot;files*&quot;, &quot;/var/lib&quot; # example of globbing

# copy all files named `files*`, but ignore the ones that start with `files1*`.
copy &quot;files*&quot;, &quot;/var/lib&quot;, ignore_list: [&quot;files1*&quot;] 
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

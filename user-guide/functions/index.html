<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Functions - Box</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	      <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <img class="box-logo" src="https://raw.githubusercontent.com/box-builder/box/master/docs-theme/img/box-logo.png">
            <a class="navbar-brand" href="../..">Box</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../.." class="dropdown-toggle"><span>Intro</span></a>
                    </li>
                    <li >
                        <a href="../../usage/" class="dropdown-toggle"><span>Usage</span></a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span>User Guide<b class="caret"></b></span></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../cli/">Command-Line Options</a>
</li>
                            
<li >
    <a href="../verbs/">Verbs</a>
</li>
                            
<li class="active">
    <a href="./">Functions</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a class="git-link" href="https://github.com/box-builder/box">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>


            </ul>
        </div>
    </div>
</div>
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#save">save</a></li>
        <li class="main "><a href="#skip">skip</a></li>
        <li class="main "><a href="#import">import</a></li>
        <li class="main "><a href="#getenv">getenv</a></li>
        <li class="main "><a href="#read">read</a></li>
        <li class="main "><a href="#getuid">getuid</a></li>
        <li class="main "><a href="#getgid">getgid</a></li>
    </ul>
</div></div>

        <div class="container">
            <div class="col-md-9" role="main">

<p>Functions in Box provide a data-passing mechanism for build instructions. For
example, you may wish to read the contents of a file from the container into
your build for further processing; the <code>read</code> function allows that.</p>
<p>These are the functions supported by Box.</p>
<h2 id="save">save</h2>
<p><code>save</code> saves an image with parameters:</p>
<ul>
<li><code>tag</code>: tag the image in the docker image store. This does not generate a
  commit, like the <code>tag</code> verb does.</li>
<li><code>file</code>: save the image to a file. The resulting file will be a bare tarball
  with the image contents, suitable for <code>docker load</code>.</li>
<li><code>type</code>: Two options: <code>docker</code>, and <code>oci</code>.</li>
</ul>
<p>Example:</p>
<p>Tag an image with the name "foo":</p>
<pre><code class="ruby">from &quot;ubuntu&quot;
save tag: &quot;foo&quot;
</code></pre>

<p>Save the ubuntu image to file after updating it:</p>
<pre><code class="ruby">from &quot;ubuntu&quot;
run &quot;apt-get update -qq &amp;&amp; apt-get dist-upgrade -y&quot;
save file: &quot;ubuntu-with-update.tar&quot;
</code></pre>

<h2 id="skip">skip</h2>
<p>skip skips all layers within its block in the final produced image, which may
be tagged with the <code>-t</code> commandline argument or modified in an <code>after</code> clause.</p>
<p>Note that any other tagging or references to images built will still be
available with full image contents, this only affects the final output image.</p>
<p><strong>WARNING</strong>: This command can cause extreme latency over TCP connections as it
rebuilds images locally, which requires it to pull down and re-push any images.
It is strongly recommended you build on the host you wish to push from or use.</p>
<p>Example:</p>
<p>This will import the <code>debian</code> image, and run commands to install software
via <code>apt-get</code>. Then it will remove the update process's layer's contents from
the image, removing caches and other dirt from the final image.</p>
<pre><code class="ruby">from &quot;debian&quot;

skip do
  run &quot;apt-get update&quot;
end

run &quot;apt-get install tmux&quot;
</code></pre>

<h2 id="import">import</h2>
<p>import loads a ruby file, and then executes it as if it were a box plan. This
is principally used to modularize build instructions between multiple builds.</p>
<p>Note that this will load ruby files specified anywhere on the filesystem. Use
at your own risk. You can provide the <code>-o import</code> option to omit this function
from use.</p>
<p>Example:</p>
<p>File A:</p>
<pre><code class="ruby">from &quot;debian&quot;
</code></pre>

<p>File B imports File A and builds on it:</p>
<pre><code class="ruby">import &quot;file-a.rb&quot;
run &quot;ls&quot;
</code></pre>

<h2 id="getenv">getenv</h2>
<p>getenv retrieves a value from the building environment (passed in as string)
and returns a string with the value. If no value exists, an empty string is
returned.</p>
<p>Example:</p>
<pre><code class="ruby"># If you set IMAGE=ceph/rbd:latest in your environment, that would be pulled
# via the `from` statement.
from getenv(&quot;IMAGE&quot;)
</code></pre>

<h2 id="read">read</h2>
<p>read takes a filename as string, reads it from the latest image in the
evaluation and returns its data. Yields an error if the file does not exist
or from has not been called.</p>
<p>read returns a string which may then be manipulated with normal string
manipulations in ruby.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
# this gets the first username in your passwd file inside the debian image
run &quot;echo #{read(&quot;/etc/passwd&quot;).split(&quot;\n&quot;).first.split(&quot;:&quot;)[0]}&quot;
</code></pre>

<h2 id="getuid">getuid</h2>
<p>getuid, given a string username provides an integer response with the UID of
the user. This works by reading the /etc/passwd file in the image.</p>
<p>Yields an error if it cannot find the user or from has not been called.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
run &quot;useradd -m -d /home/erikh -s /bin/sh erikh&quot;
run &quot;id #{getuid(&quot;erikh&quot;)}&quot;
</code></pre>

<h2 id="getgid">getgid</h2>
<p>getgid, given a string group name provides an integer response with the GID
of the group. This works by reading the /etc/group file in the image.</p>
<p>Yields an error if it cannot find the group or from has not been called.</p>
<p>Example:</p>
<pre><code class="ruby">from &quot;debian&quot;
run &quot;groupadd cabal&quot;
run &quot;getent group #{getgid(&quot;cabal&quot;)}&quot;
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

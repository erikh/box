<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Usage - Box</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

	      <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <img class="box-logo" src="https://raw.githubusercontent.com/box-builder/box/master/docs-theme/img/box-logo.png">
            <a class="navbar-brand" href="..">Box</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href=".." class="dropdown-toggle"><span>Intro</span></a>
                    </li>
                    <li class="active">
                        <a href="./" class="dropdown-toggle"><span>Usage</span></a>
                    </li>
                    <li >
                        <a href="../installation/" class="dropdown-toggle"><span>Installation</span></a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span>User Guide<b class="caret"></b></span></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../user-guide/cli/">Command-Line Options</a>
</li>
                            
<li >
    <a href="../user-guide/verbs/">Verbs</a>
</li>
                            
<li >
    <a href="../user-guide/functions/">Functions</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li>
                        <a class="git-link" href="https://github.com/box-builder/box">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>


            </ul>
        </div>
    </div>
</div>
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#usage">Usage</a></li>
            <li><a href="#use-the-shell">Use the shell</a></li>
            <li><a href="#with-a-plan">With a Plan</a></li>
            <li><a href="#with-multiple-plans">With Multiple Plans</a></li>
        <li class="main "><a href="#making-box-plans">Making Box Plans</a></li>
        <li class="main "><a href="#example-box-plan">Example Box Plan</a></li>
            <li><a href="#ignoring-files">Ignoring files</a></li>
            <li><a href="#the-build-cache">The Build Cache</a></li>
        <li class="main "><a href="#example-box-plan-advanced-version">Example Box Plan (advanced version)</a></li>
    </ul>
</div></div>

        <div class="container">
            <div class="col-md-9" role="main">

<h2 id="usage">Usage</h2>
<h3 id="use-the-shell">Use the shell</h3>
<p>If you want to try out box quickly, you can use the shell interface, AKA
repl (read-eval-print loop):</p>
<pre><code class="bash">$ box repl
# or
$ box shell
</code></pre>

<p>This video gives a quick demo of the shell:</p>
<script type="text/javascript" src="https://asciinema.org/a/c1n0h0g73f10x4cuzjf1i51vg.js" id="asciicast-c1n0h0g73f10x4cuzjf1i51vg" async></script>

<h3 id="with-a-plan">With a Plan</h3>
<p>The commandline tool <code>box</code> accepts a file (your "build plan") as a commandline
argument:</p>
<pre><code class="bash">$ box myplan.rb
</code></pre>

<p>The current working directory that Box runs in is very important, it is the
jumping-off point for most copy operations. If you run the <code>box-builder/box</code>
container, you may wish to run it in this way:</p>
<pre><code class="bash">$ docker run -i \
  -v $PWD:$PWD \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -w $PWD \
  box-builder/box:latest myplan.rb
</code></pre>

<p>For additional flags and functionality, see the help:</p>
<pre><code class="bash">$ box --help
</code></pre>

<h3 id="with-multiple-plans">With Multiple Plans</h3>
<p>To initiate multi-plan builds (where all builds are done at the same time) just
invoke <code>box multi</code> and specify all the plans you want, e.g.:</p>
<pre><code>$ box multi *.rb
</code></pre>

<p>Which will build all the <code>.rb</code> files in the current dir.</p>
<p><strong>Note</strong>: it is important to use the <a href="../user-guide/verbs/#tag">tag</a> verb to
avoid losing track of your images!</p>
<h2 id="making-box-plans">Making Box Plans</h2>
<p>Box plans are written in mruby, an embedded, smaller variant of ruby. If you
are new to ruby, here is a tutorial that only <a href="https://github.com/jhotta/chef-fundamentals-ja/blob/master/slides/just-enough-ruby-for-chef/01_slide.md#variables">covers the basics</a>
You will not need to be an advanced ruby user to leverage Box.</p>
<p>Box plan terms are either functions or verbs.</p>
<p>Verbs typically create a layer and are meant to run at the top level of the
plan; they are not intended to return a sane value other than success/fail.
Operations like <code>run</code> and <code>copy</code> fit into the "verb" category. These are very
similar to the verbs you'd find in <code>docker build</code>.</p>
<p>Functions are unique to Box and allow you to pass data both from the image into
the build system and pass it to other calls, or just print it out for later
use. Functions like <code>getuid</code> exist to retrieve the UID of a user as the
container sees it, for the purposes of using it for future operations.</p>
<p>Please take a look at our <a href="../user-guide/verbs">verbs reference</a> and <a href="../user-guide/functions">functions
reference</a> for more information.</p>
<h2 id="example-box-plan">Example Box Plan</h2>
<p>Here's a basic example that downloads the newest (1.7.3) version of golang with
curl and unpacks it. If you set an environment variable called
<code>GO_VERSION</code>, it will use that version instead.</p>
<pre><code class="ruby">from &quot;debian&quot;

run &quot;apt-get update&quot;
run &quot;apt-get install curl -y&quot;

go_version = getenv(&quot;GO_VERSION&quot;)

if go_version.empty?
  go_version = &quot;1.7.3&quot;
end

url = &quot;https://storage.googleapis.com/golang/go#{go_version}.linux-amd64.tar.gz&quot;

run &quot;curl -sSL '#{url}' | tar -xvz -C /usr/local&quot;
</code></pre>

<h3 id="ignoring-files">Ignoring files</h3>
<p>Just like Docker, if a <code>.dockerignore</code> file exists, the patterns, filenames,
and directories specified in this file will be ignored from all copy operations.</p>
<p>The <a href="../user-guide/verbs/#copy">copy</a> verb also has additional functionality to
scope ignore rules down to specific copy statements.</p>
<h3 id="the-build-cache">The Build Cache</h3>
<p>The build cache is enabled by default. It is not an exact cache but constructs
the layer graph in a non-standard way using docker's image Comment field,
populating it with sums and command instructions in a very similar way that
<code>docker build</code> does.</p>
<p>If you find the behavior surprising, you can turn it off:</p>
<pre><code>$ box --no-cache myplan.rb
</code></pre>

<h2 id="example-box-plan-advanced-version">Example Box Plan (advanced version)</h2>
<p>This is the Box plan we use to build Box itself. It uses many of its
features. Be sure to check the <a href="https://box-builder.github.io/box/verbs/">verbs</a> to
refer to different constructs used in the file.</p>
<p>You can find the latest version of it
<a href="https://github.com/box-builder/box/blob/master/build.rb">here</a> too.</p>
<pre><code class="ruby">from &quot;golang&quot;

skip do
  DOCKER_VERSION = &quot;1.12.4&quot;

  PACKAGES = %w[
    build-essential
    g++
    git
    wget
    curl
    ruby
    bison
    flex
    iptables
    psmisc
    python-pip
  ]

  workdir &quot;/&quot;

  qq = getenv(&quot;CI_BUILD&quot;) != &quot;&quot; ? &quot;-qq&quot; : &quot;&quot;

  run &quot;apt-get update #{qq}&quot;
  run &quot;apt-get install -y #{qq} #{PACKAGES.join(&quot; &quot;)}&quot;
  env &quot;GOPATH&quot; =&gt; &quot;/go&quot;

  docker_path = &quot;docker-#{DOCKER_VERSION}.tgz&quot;
  run &quot;wget -q https://get.docker.com/builds/Linux/x86_64/#{docker_path}&quot;
  run &quot;tar -xpf #{docker_path} --strip-components=1 -C /usr/bin/&quot;
  run &quot;rm #{docker_path}&quot;
  copy &quot;dind&quot;, &quot;/dind&quot;

  run &quot;pip -q install mkdocs mkdocs-bootswatch&quot;

  copy &quot;.&quot;, &quot;/go/src/github.com/box-builder/box&quot;
  run &quot;cd /go/src/github.com/box-builder/box &amp;&amp; make clean install&quot;

  workdir &quot;/go/src/github.com/box-builder/box&quot;
  set_exec entrypoint: [&quot;/dind&quot;], cmd: [&quot;make&quot;, &quot;docker-test&quot;]
  tag &quot;box-test&quot;
end

run &quot;mv /go/bin/box /box&quot;
set_exec entrypoint: [&quot;/box&quot;], cmd: []
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
